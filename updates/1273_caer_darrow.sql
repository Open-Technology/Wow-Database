-- I see dead people...
-- ... they are everywhere and they don't know they are dead.
-- Added the missing ghost NPCs in Caer Darrow
-- Spawn points and equipment from UDB
-- Waypoints from PSMDB
-- Melia and Sammy script (text and waypoints) from data by @evil-at-wow (many thanks :) )
-- Fixed factions, models, mounts and addons for the ghosts and pooled one of the patrol

SET @GUID := 98616;
SET @ENTRY := 2434;

DELETE FROM `creature` WHERE `guid` BETWEEN @GUID + 1 AND @GUID + 22;
INSERT INTO `creature` VALUES
(@GUID + 1, 11277, 0, 0, 0, 1093.95, -2528.63, 61.2475, 5.74213, 0, 0, 0, 484, 0, 0, 0),
(@GUID + 2, 11277, 0, 0, 0, 1095.56, -2529.47, 61.1291, 2.37365, 0, 0, 0, 484, 0, 0, 0),
(@GUID + 3, 11277, 0, 0, 0, 1148.08, -2559.31, 60.1493, 4.15388, 0, 0, 0, 484, 0, 0, 0),
(@GUID + 4, 11277, 0, 0, 0, 1146.79, -2561.22, 60.1145, 0.959931, 0, 0, 0, 484, 0, 0, 0),
(@GUID + 5, 11279, 0, 0, 0, 1064.06, -2519.78, 60.2259, 3.19395, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 6, 11279, 0, 0, 0, 1056.5, -2536.54, 59.9694, 2.35619, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 7, 11279, 0, 0, 0, 1245.02, -2597.47, 90.3675, 3.52556, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 8, 11280, 0, 0, 0, 1180.07, -2536.72, 85.3681, 1.0821, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 9, 11280, 0, 0, 0, 1187.12, -2532.58, 85.3681, 2.16421, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 10, 11280, 0, 0, 0, 1208.19, -2583.32, 98.2479, 2.72271, 0, 0, 0, 3632, 0, 0, 0),
(@GUID + 11, 11282, 0, 0, 0, 1113.59, -2555.59, 59.2532, 3.50681, 0, 0, 0, 42, 0, 0, 0),
(@GUID + 12, 11283, 0, 0, 0, 1111.49, -2556.4, 59.2532, 0.365222, 0, 0, 0, 42, 0, 0, 0),
(@GUID + 13, 11316, 0, 0, 0, 1223.27, -2506.41, 72.9261, 4.10152, 0, 0, 0, 3500, 0, 0, 0),
(@GUID + 15, 11281, 0, 0, 0, 1098.49, -2523.82, 61.3707, 4.6691, 1272, 0, 0, 2371, 0, 0, 0),
(@GUID + 16, 11281, 0, 0, 0, 1031.16, -2498.27, 59.177, 4.73616, 1272, 0, 0, 2371, 0, 0, 2),
(@GUID + 17, 11281, 0, 0, 0, 1090.52, -2541.25, 59.2419, 2.70896, 1272, 0, 0, 2371, 0, 0, 2),
(@GUID + 18, 11281, 0, 0, 0, 1147.93, -2566.49, 60.0373, 2.74489, 1272, 0, 0, 2371, 0, 0, 0),
(@GUID + 19, 11281, 0, 0, 0, 1151.78, -2557.18, 60.0758, 2.79201, 1272, 0, 0, 2371, 0, 0, 0),
(@GUID + 14, 11277, 0, 0, 0, 1155.4, -2383.73, 60.304, 5.43574, 300, 0, 0, 2784, 0, 0, 0),
(@GUID + 20, 11277, 0, 0, 0, 1127.81, -2387.71, 59.264, 1.72159, 300, 0, 0, 2784, 0, 0, 0),
(@GUID + 21, 11287, 0, 0, 0, 1081.91, -2574, 59.957, 0.301, 360, 0, 0, 1536, 0, 0, 0),
(@GUID + 22, 11277, 0, 11014, 0, 1090.52, -2541.25, 59.2419, 2.70896, 1272, 0, 0, 2784, 0, 0, 2);

DELETE FROM `creature_movement` WHERE `id` IN (@GUID + 16, @GUID + 17, @GUID + 20);
INSERT INTO `creature_movement` VALUES 
(@GUID + 16, 1, 1031.16, -2498.27, 59.177, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 4.73616, 0, 0),
(@GUID + 16, 2, 1034.48, -2468.77, 59.9844, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.856512, 0, 0),
(@GUID + 16, 3, 1043.48, -2458.4, 60.4699, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.500247, 0, 0),
(@GUID + 16, 4, 1071.23, -2443.23, 61.1634, 5000, 0, 0, 0, 0, 0, 0, 0, 0, 0.841458, 0, 0),
(@GUID + 16, 5, 1101.41, -2409.45, 59.8655, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.465122, 0, 0),
(@GUID + 16, 6, 1125.81, -2397.36, 59.4695, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.003482, 0, 0),
(@GUID + 16, 7, 1183.61, -2397.16, 60.1768, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 0.003482, 0, 0),
(@GUID + 16, 8, 1126.2, -2397.42, 59.4867, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.59711, 0, 0),
(@GUID + 16, 9, 1101.19, -2409.67, 59.8831, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.96843, 0, 0),
(@GUID + 16, 10, 1070.91, -2443.54, 61.1405, 5000, 0, 0, 0, 0, 0, 0, 0, 0, 3.71754, 0, 0),
(@GUID + 16, 11, 1043.16, -2458.72, 60.4674, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.91825, 0, 0),
(@GUID + 16, 12, 1034.42, -2468.71, 59.9897, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.55552, 0, 0),
(@GUID + 17, 1, 1090.52, -2541.25, 59.1419, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 2.70896, 0, 0),
(@GUID + 17, 2, 1095.36, -2543.49, 59.1418, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.08741, 0, 0),
(@GUID + 17, 3, 1118.02, -2601.04, 59.4689, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.50891, 0, 0),
(@GUID + 17, 4, 1132.05, -2612.48, 63.1381, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6.05083, 0, 0),
(@GUID + 17, 5, 1161.32, -2620.66, 70.9007, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6.01069, 0, 0),
(@GUID + 17, 6, 1193.38, -2629.62, 74.0911, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.545408, 0, 0),
(@GUID + 17, 7, 1214.63, -2616.73, 83.1397, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.11242, 0, 0),
(@GUID + 17, 8, 1221.01, -2604.11, 86.3537, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.490212, 0, 0),
(@GUID + 17, 9, 1237.11, -2595.52, 90.1566, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 0.490212, 0, 0),
(@GUID + 17, 10, 1221.38, -2603.91, 86.4882, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.17329, 0, 0),
(@GUID + 17, 11, 1214.67, -2616.99, 83.1357, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.70663, 0, 0),
(@GUID + 17, 12, 1193.52, -2629.6, 74.1169, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.88873, 0, 0),
(@GUID + 17, 13, 1161.14, -2620.61, 70.8684, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.86364, 0, 0),
(@GUID + 17, 14, 1131.64, -2612.35, 63.038, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.5425, 0, 0),
(@GUID + 17, 15, 1117.74, -2600.92, 59.4468, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.89018, 0, 0),
(@GUID + 17, 16, 1095.2, -2543.02, 59.1423, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.68802, 0, 0),
(@GUID + 22, 1, 1090.52, -2541.25, 59.1419, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 2.70896, 0, 0),
(@GUID + 22, 2, 1095.36, -2543.49, 59.1418, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.08741, 0, 0),
(@GUID + 22, 3, 1118.02, -2601.04, 59.4689, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.50891, 0, 0),
(@GUID + 22, 4, 1132.05, -2612.48, 63.1381, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6.05083, 0, 0),
(@GUID + 22, 5, 1161.32, -2620.66, 70.9007, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6.01069, 0, 0),
(@GUID + 22, 6, 1193.38, -2629.62, 74.0911, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.545408, 0, 0),
(@GUID + 22, 7, 1214.63, -2616.73, 83.1397, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.11242, 0, 0),
(@GUID + 22, 8, 1221.01, -2604.11, 86.3537, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.490212, 0, 0),
(@GUID + 22, 9, 1237.11, -2595.52, 90.1566, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 0.490212, 0, 0),
(@GUID + 22, 10, 1221.38, -2603.91, 86.4882, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4.17329, 0, 0),
(@GUID + 22, 11, 1214.67, -2616.99, 83.1357, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.70663, 0, 0),
(@GUID + 22, 12, 1193.52, -2629.6, 74.1169, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.88873, 0, 0),
(@GUID + 22, 13, 1161.14, -2620.61, 70.8684, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.86364, 0, 0),
(@GUID + 22, 14, 1131.64, -2612.35, 63.038, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.5425, 0, 0),
(@GUID + 22, 15, 1117.74, -2600.92, 59.4468, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.89018, 0, 0),
(@GUID + 22, 16, 1095.2, -2543.02, 59.1423, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.68802, 0, 0);

SET @POOL := 25452;

DELETE FROM `pool_creature` WHERE `guid` IN (@GUID + 17, @GUID + 22);
INSERT INTO `pool_creature` VALUES
(@GUID + 17, @POOL, 0, 'Caer Darrow ghosts'),
(@GUID + 22, @POOL, 0, 'Caer Darrow ghosts');

DELETE FROM `pool_template` WHERE `entry` = @POOL;
INSERT INTO `pool_template` VALUES
(@POOL, 1, 'Caer Darrow ghosts');

UPDATE `creature_template` SET `FactionAlliance`= 35, `FactionHorde` = 35 WHERE `Entry` IN (11277, 11279, 11280, 11281, 11282, 11283, 11287, 11316);

UPDATE `creature_template_addon` SET `mount` = 5228 WHERE `entry` = 11281;
UPDATE `creature_template_addon` SET `b2_0_sheath` = 1 WHERE `entry` IN (11277, 11279, 11280, 11287, 11316);

DELETE FROM `creature_addon` WHERE `guid` = @GUID + 8;
INSERT INTO `creature_addon` VALUES
(@GUID + 8, 0, 0, 0, 0, 69, 0, '17622');

DELETE FROM `creature_equip_template_raw` WHERE `entry` BETWEEN @ENTRY + 1 AND @ENTRY + 5;
INSERT INTO `creature_equip_template_raw` (`entry`, `equipmodel1`, `equipmodel2`, `equipmodel3`, `equipinfo1`, `equipinfo2`, `equipinfo3`, `equipslot1`, `equipslot2`, `equipslot3`) VALUES
(@ENTRY + 1, 1550, 18812, 0, 33490690, 234948100, 0, 781, 4, 0), -- ok
(@ENTRY + 2, 6581, 0, 0, 33492482, 0, 0, 1805, 0, 0), -- ok
(@ENTRY + 3, 6584, 0, 0, 33490690, 0, 0, 781, 0, 0),
(@ENTRY + 4, 6520, 0, 0, 33488900, 0, 0, 1815, 0, 0), -- ok
(@ENTRY + 5, 1661, 24282, 0, 33490690, 33492482, 0, 781, 1815, 0);

UPDATE `creature_template` SET `ModelId2` = 11014, `EquipmentTemplateId` = @ENTRY + 2 WHERE `Entry` = 11277;
UPDATE `creature_template` SET `ModelId2` = 11022, `EquipmentTemplateId` = @ENTRY + 1 WHERE `Entry` = 11279;
UPDATE `creature_template` SET `ModelId2` = 11019, `EquipmentTemplateId` = @ENTRY + 4 WHERE `Entry` = 11280;
UPDATE `creature_template` SET `EquipmentTemplateId` = @ENTRY + 3 WHERE `Entry` = 11287;
UPDATE `creature_template` SET `EquipmentTemplateId` = @ENTRY + 5 WHERE `Entry` = 11316;

-- scripted Melia and Sammy
SET @TEXT := 2000000612;

UPDATE `creature_template` SET `MovementType` = 2 WHERE `Entry` IN (11282, 11283);
UPDATE `creature` SET `MovementType` = 2 WHERE `id` IN (11282, 11283);

DELETE FROM `creature_movement_template` WHERE `entry` IN (11282, 11283);
INSERT INTO `creature_movement_template` VALUES
(11282, 1, 1120.09, -2547.57, 59.2532, 0, 1128201, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11282, 2, 1111.05, -2537.9, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11282, 3, 1100.43, -2547.73, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11282, 4, 1109.6, -2558.2, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11282, 5, 1113.59, -2555.59, 59.2532, 0, 1128205, 0, 0, 0, 0, 0, 0, 0, 3.4950, 0, 0),
(11282, 6, 1113.59, -2555.59, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.4950, 0, 0),
(11283, 1, 1120.72, -2548.21, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11283, 2, 1110.95, -2538.51, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11283, 3, 1100.73, -2547.23, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11283, 4, 1109.56, -2557.59, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11283, 5, 1111.49, -2556.4, 59.2532, 0, 1128305, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0),
(11283, 6, 1111.49, -2556.4, 59.2532, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0);

DELETE FROM `dbscripts_on_creature_movement` WHERE `id` = 1128201;
INSERT INTO `dbscripts_on_creature_movement` VALUES
(1128205, 0, 32, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'pause WP movement'),
(1128205, 6, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3.4950, 'Melia face Sammy'),
(1128205, 9, 0, 0, 0, 0, 0, 0, @TEXT + 3, 0, 0, 0, 0, 0, 0, 0, 'Melia'),
(1128205, 14, 0, 0, 0, 11283, 20, 0, @TEXT + 4, 0, 0, 0, 0, 0, 0, 0, 'Sammy'),
(1128205, 16, 0, 0, 0, 0, 0, 0, @TEXT + 5, 0, 0, 0, 0, 0, 0, 0, 'Melia'),
(1128205, 17, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Melia unactive'),
(1128205, 17, 21, 0, 0, 11283, 20, 7, 0, 0, 0, 0, 0, 0, 0, 0, 'Sammy unactive'),
(1128205, 30, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'unpause WP movement'),
(1128205, 30, 0, 0, 0, 0, 0, 0, @TEXT + 1, 0, 0, 0, 0, 0, 0, 0, 'Melia'),
(1128205, 31, 32, 0, 0, 11283, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Sammy unpause WP movement'),
(1128205, 31, 0, 0, 0, 11283, 20, 0, @TEXT + 2, 0, 0, 0, 0, 0, 0, 0, 'Sammy'),

(1128201, 0, 31, 11283, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'search for Sammy'),
(1128201, 1, 21, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Melia active'),
(1128201, 1, 21, 1, 0, 11283, 20, 7, 0, 0, 0, 0, 0, 0, 0, 0, 'Sammy active'),
(1128201, 1, 25, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Melia - run on'),
(1128201, 1, 25, 1, 0, 11283, 20, 7, 0, 0, 0, 0, 0, 0, 0, 0, 'Sammy - run on'),

(1128305, 0, 32, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'Sammy pause WP movement');

DELETE FROM `db_script_string` WHERE `entry` BETWEEN @TEXT + 1 AND @TEXT + 5;
INSERT INTO `db_script_string` VALUES
(@TEXT + 1, 'Ready. Set. GO!', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 0, NULL),
(@TEXT + 2, 'HEY! No fair!', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 0, NULL),
(@TEXT + 3, 'I win!', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 0, NULL),
(@TEXT + 4, 'You cheated!', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 0, NULL),
(@TEXT + 5, 'Wanna race again? Best two out of three!', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0, 0, 0, 0, NULL);
